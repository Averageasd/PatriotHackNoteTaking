Output: SEPARABLE BILATERAL FILTERING FOR FAST VIDEO PREPROCESSING Tuan Q. Pham Lucas J. van Vliet Quantitative Imaging Group, Department of Imaging Science and Technology Delft University of Technology http://www.qi.tnw.tudelft.nl/~lucas ABSTRACT fast implementation of bilateral filtering is therefore desir- able. Bilateral filtering is an edge-preserving filtering technique One first attempt to speedup the bilateral filter is a piece- that employs both geometric closeness and photometric sim- wise linear approximation proposed by Durrand and Dorsey ilarity of neighboring pixels to construct its filter kernel. [6]. The method is similar to the idea of channel filter- Multi-dimensional bilateral filtering is computationally ex- ing by Felsberg and Grandlund [7], in which the image is pensive because the adaptive kernel has to be recomputed at spatio-tonally filtered with respect to a number of intensity every pixel. In this paper, we present a separable implemen- channels. The output image is then a pixel-wise interpola- tation of the bilateral filter. The separable implementation tion of the channel responses. Although the computation of offers equivalent adaptive filtering capability at a fraction of each channel response requires only two Gaussian convo- execution time compared to the traditional filter. Because of lutions, many channels are needed to cover the whole dy- this efficiency, the separable bilateral filter can be used for namic range (up to 17 in [6]). The gain in speed is therefore fast preprocessing of images and videos. Experiments show only apparent for very large kernels (kernel size > 25 pixels that better image quality and higher compression efficiency per dimension as shown in figure 11 in [6]). The piecewise- is achievable if the original video is preprocessed with the linear approximation is also not suitable for large images separable bilateral filter. or videos because of excessive memory needed to store the temporary channel images. 1. INTRODUCTION In this paper, we propose a fast separable implementa- tion of the bilateral filter. The image is bilaterally filtered in Bilateral filtering is a term coined by Tomasi and Manduchi one dimension and the intermediate result is filtered again [12] in 1998 to refer to an edge-preserving filtering tech- in subsequent dimensions. The separable implementation is nique that takes both geometric closeness and photometric not only fast but it also approximates the true bilateral filter similarity of neighboring pixels into account. The edge- reasonably well. Little memory overhead is required since preserving capability is due to an implicit local mode se- the output image can be written direct onto the input's mem- lection as a result of intensity-selective filtering [3]. In fact, ory. Experiments on various images show that the separa- the idea of filtering in both spacial and tonal domains has ble implementation outperforms both the original and the been around since the sigma filter [8] in 1983. Smith and piecewise-linear implementation in speed while achieving Brady [11] in 1995 added Gaussian weighting to the sigma similar filtering results. As an application, the separable bi- filter and produced their own version of bilateral filter. The lateral filtering is applied to noisy videos to improve image bilateral filter has also been shown [2, 3] to be equivalent quality and coding efficiency of video compression systems. to a number of known techniques such as anisotropic dif- fusion [10], local-mode finding [3] and mean-shift analysis 2. BILATERAL FILTERING [5]. Recently, Boomgaard and Weijer [4] extended bilat- eral filtering to a robust facet model to estimate local image Bilateral filtering performs a weighted average of local sam- structures under random noise and outliers. ples, in which higher weights are given to samples that are Although the bilateral filter produces excellent filtered closer in both space and intensity to the center sample. The results, its application is limited by its speed. The filter's weighted average is done over a neighborhood S around the computational complexity is high and it increases exponen- center sample SO = {x0,yo} whose intensity is I(so): tially with the number of dimensions. Equivalent filtering techniques such as anisotropic diffusion and mean-shift anal- (1) ysis are not fast either because of their iterative nature. A 0-7803-9332-5/05/$20.00©2005 IE Authorized licensed use limited to: George Mason University. Downloaded on September 08,2023 at 20:50:46 UTC from IEEE Xplore. Restrictions apply. operations per pixel irrespective of the Gaussian scale [14] (O(Nd), where N is the total number of pixels in the image, and d is the image dimensionality). Unfortunately, the bilat- eral filter f(s,so) in (1) is not separable due to the intensity- dependent component gt. However, when implemented in (a) noisy edge (b) bilateral filter (c) filtered output a separable way, the new filter still satisfies all desired re- quirements: noise reduction and signal preservation. gs Spatial Local Pr(I) weights modes Similar to separable Gaussian filtering, a one-dimen- after bilateral histogram sional bilateral filter is applied to the first dimension and gt before the intermediate result is filtered again in subsequent di- filtering filtering mensions. In this way, the computational complexity of Tonal Cross- the separable implementation is just O(Nmd) compared to section of a weights O(Nmd) for a full kernel implementation (where m is the step edge 0 255 size of the filter in each dimension). With a modest filter (d) spatial and tonal filters (e) thinning histogram size of 7, for example, the speed improvement of the sepa- rable filter over the original filter could reach 3.5 times for Fig. 1. Bilateral filtering as a mode seeking process. 2D and 16 times for 3D data. Not sacrificing performance for speed, the separable bi- lateral filter is also a good approximation to the original = - I(so)) is the bilat- filter. Similar to a separable median filter [9], the separa- eral filter for the neighborhood around So. The constituent ble bilateral filter first seeks the local mode along the X- spatial and tonal weights gs and gt are Gaussian functions: dimension, followed by a mode seeking in the y-dimension. gt(I) = g(I,Ot) Because of the non-separability of so) in (1), differ- (2) ent orderings of filtering could result in a slightly different where g(t,o)== and Ot are the spatial output. However, the difference is often small for normal Signal-to-Noise Ratios (SNR > 20dB). Also, due to the and tonalscales ofbilateral filtering separable filtering along the sampling axes, the proposed fil- Figure 1 depicts the formation of a bilateral filter cen- ter approximates the original filter better for image patches tered at a pixel on one side of a noisy step edge (fig. 1a). whose dominant orientation aligns with the sampling grid. The role of the spatial weight gs is to limit the spatial ex- Nevertheless, even in a worst case scenario of a 45° -tilt step tend of the filter operation. It accounts for the bell shape of edge in figure 2, the separable filter still performs noise re- the bilateral filter. The tonal weight gt suppresses the con- duction and edge preservation very well. tributions of pixels from the other side of the edge. It is responsible for the truncation of approximately half of the Gaussian bell (fig. 1b). Since only pixels sharing similar 3.1. Kernel approximation in 2D intensity with the current pixel have significant weights in We show how an effective kernel of the separable bilateral the local analysis, the edge is not diffused across and noise filtering looks like on the verge of a 45° -tilt step edge. Im- is effectively suppressed (fig. 1c). A compact bi-modal his- ages on the top row of figure 2 show an input patch and its togram of the filtered edge compared to that of the noisy separable filter kernels as gray-scale images (brighter pixel edge in figure 1e further confirms this noire reduction and mean higher filter weight and vice versa). The center pixel edge sharpening. As pointed out in [3], bilateral filtering is lies just on the white side of the edge in the middle of the a first iteration of an iterative local mode finding process. image in figure 2a. Since we are interested in the effective If the bilateral filter is applied several times, the filtered re- kernel centered at this pixel, intermediate 1D kernels in the sult will eventually converge to a sharp edge transition and X- and y-dimensions are shown in figure 2b-d. the local histogram will reduce to two spikes at the intensity In the first step, a horizontal bilateral filtering is applied levels on either sides of the edge. to all rows of the input image. The x-kernels centered at pixels in the middle column are shown in figure 2b. As can 3. SEPARABLE BILATERAL FILTERING be seen in figure 2b, bilateral filtering assigns low weights to the pixels far away from the center position and pixels Gaussian filtering is very fast because it can be implemented with a large intensity difference from the center intensity in a separable way (i.e. the image is first filtered in the X- (which changes from high to low as the center pixel moves dimension, followed by a filtering in the y-dimension and SO from top of the column to the bottom). on...). A recursive implementation of the separable Gaus- sian filter, for example, only requires a fixed number of 1 SNR=1010g10(02/02): where 02,02 are variances of signal, noise Authorized licensed use limited to: George Mason University. Downloaded on September 08,2023 at 20:50:46 UTC from IEEE Xplore. Restrictions apply. 
